<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cesium/1.106.0/Cesium.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cesium/1.106.0/Widgets/widgets.min.css" rel="stylesheet">

  <style>
    html, body, #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    .toolbar-left {
      display: block;
      position: absolute;
      top: 5px;
      left: 5px;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <script type="module">
    const esri = new Cesium.ArcGisMapServerImageryProvider({
      url : 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer'
    });

    var viewer = new Cesium.Viewer('cesiumContainer', {
      imageryProvider: esri,
      baseLayerPicker: false
    });

    var terrainProvider = new Cesium.CesiumTerrainProvider({
      url : '__TERRAIN_URL__'
    });
    viewer.scene.terrainProvider = terrainProvider;
    viewer.scene.globe.enableLighting = true;
    viewer.scene.globe.terrainExaggeration = 1;
    viewer.scene.globe.depthTestAgainstTerrain = true;
    viewer.scene.highDynamicRange = false;

    // Add 3D tileset
    const tileset = await Cesium.Cesium3DTileset.fromUrl('./data/tiles/tileset.json');
    viewer.scene.primitives.add(tileset);

    // zoom to tileset
    try {
      await viewer.zoomTo(tileset, new Cesium.HeadingPitchRange(0, -0.3, 0));
    } catch (e) {
      console.error("Failed to zoom to tileset:", e);
    }

    // Keep camera light in sync
    viewer.scene.light = new Cesium.DirectionalLight({
      direction: viewer.scene.camera.directionWC,
    });
    viewer.scene.preRender.addEventListener(function () {
      viewer.scene.light.direction = Cesium.Cartesian3.clone(
        viewer.scene.camera.directionWC,
        viewer.scene.light.direction
      );
    });

    // Highlight feature on hover
    const highlightColor = Cesium.Color.YELLOW;
    const highlighted = {
      feature: undefined,
      originalColor: new Cesium.Color(),
    };

    viewer.screenSpaceEventHandler.setInputAction(function onMouseMove(movement) {
      if (Cesium.defined(highlighted.feature)) {
        highlighted.feature.color = highlighted.originalColor;
        highlighted.feature = undefined;
      }
      const pickedFeature = viewer.scene.pick(movement.endPosition);
      if (pickedFeature instanceof Cesium.Cesium3DTileFeature) {
        highlighted.feature = pickedFeature;
        Cesium.Color.clone(pickedFeature.color, highlighted.originalColor);
        pickedFeature.color = highlightColor;
      }
    }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);

  </script>
</body>
</html>
